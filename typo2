/** FUNCIONES */

function estaElAsientoReservado (id) {

    const reserva = asientosReservados.find( (elemento) => {
        return elemento.id === id;
    });

    return (reserva !== undefined);
}

function renderizarAsientos () {

    // Limpiar el contenedor
    contenedor.innerHTML = "";

    for(let i = 1; i <= filas; i++) {

        // Creo la fila
        const fila = document.createElement("div");
        fila.className = "fila";

        for(let j = 1; j <= columnas; j++) {

            // Generamos el ID de los asientos
            const id = i.toString() + j.toString();

            // Crear asiento
            const asiento = document.createElement("div");

            if(estaElAsientoReservado(id)) {
                asiento.className = "asiento reservado";
            } else {
                asiento.className = "asiento";
            }

            // Crear evento de click
            asiento.addEventListener("click", (event) => {
                validarSeleccionAsiento(event, id);
            });

            // Agregar asiento a la fila
            fila.append(asiento);
        }

        // Agregar fila al contenedor
        contenedor.append(fila);

    }

}

function obtenerAsientosReservados () {

    let reservas = [];

    const reservasLS = localStorage.getItem("reservas");

    if(reservasLS !== null) {

        reservas = JSON.parse(reservasLS);
    }

    return reservas;
}

function validarSeleccionAsiento (event, id) {

    // VALIDAR QUE NO ESTÉ RESERVADO

    const target = event.target;

    // Si el asiento está seleccionado
    if (asientosSeleccionados.includes(id)) {

        // Le saco la clase seleccionado
        target.className = "asiento";

        // Borro asiento seleccionado
        asientosSeleccionados = asientosSeleccionados.filter( (elemento) => {
             return elemento !== id;
        });


    } else { // Si el asiento no está seleccionado

        // Si la cantidad de asientos seleccionados es menor a la cantidad de entradas
        if(asientosSeleccionados.length < cantidadEntradas) {

            if(!estaElAsientoReservado(id)) {
                // Agrego clase seleccionado
                target.className = "asiento seleccionado";

                // Agrego el asiento seleccionado al array
                asientosSeleccionados.push(id);
            }

        }


    }
}

/** VARIABLES GLOBALES */

const filas = 8;
const columnas = 6;
let cantidadEntradas = 0;
let asientosSeleccionados = [];
let asientosReservados = obtenerAsientosReservados();

// Elementos del DOM
const contenedor = document.getElementById("contenedor");
const selectEntradas = document.getElementById("entradas");
const form = document.getElementById("reserva");

/** INICIO */

renderizarAsientos();

selectEntradas.addEventListener("change", () => {

    cantidadEntradas = parseInt(selectEntradas.value);
});

form.addEventListener("submit", (e) => {

    e.preventDefault();

    const inputNombre = document.getElementById("nombre");
    const nombre = inputNombre.value;

    // Construyo las reservas
    for(const asientoSeleccionado of asientosSeleccionados) {
        asientosReservados.push({
            id: asientoSeleccionado,
            nombre: nombre,
        });
    }

    // Guardo en localStorage
    localStorage.setItem("reservas", JSON.stringify(asientosReservados));

    // Renderizar asientos
    renderizarAsientos();

    // Limpio los inputs
    cantidadEntradas = 0;
    asientosSeleccionados = [];
    selectEntradas.value = "0";
    inputNombre.value = "";
});


//

const paso1 = document.getElementById("paso1");
const paso2 = document.getElementById("paso2");

const selectPelicula = document.getElementById("pelicula");

selectPelicula.addEventListener("change", () => {

    if(selectPelicula.value !== "") {

        paso1.className = "no-mostrar";
        paso2.className = "";
    }

});